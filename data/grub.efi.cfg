insmod regexp
insmod part_gpt

set menu_color_normal=cyan/blue
set menu_color_highlight=white/blue

efi_found=false

for efi in (*,gpt*)/efi/*/*.efi (*,gpt*)/efi/*/*/*.efi (*,gpt*)/*.efi (*,gpt*)/*/*.efi ; do
  regexp --set=1:efi_device '^\((.*)\)/' "$efi"
  if [ -e "$efi" ]; then
    efi_found=true

    menuentry "$efi" "$efi_device" {
      root="$2"
      chainloader "$1"
    }
  fi
done

if [ "$efi_found" != true ]; then
  echo "No EFI files detected."
  echo "Press escape to return to the menu."
  sleep --interruptible 20 -v
fi

