#!/bin/sh -e

do_postinst() {
	which m-a >/dev/null || return 0

	# module-assistant calls tput, tput wants this
	export TERM=linux

	for dir in /lib/modules/*; do
		[ -d "${dir}" ] || continue
		kvers=$(basename ${dir})

		m-a --text-mode --non-inter -l "${kvers}" a-i madwifi || :
	done

	rm -rf /usr/src/modules/* /var/cache/modass/* /usr/src/*.deb

	dpkg --purge madwifi-source
}

case "${1}" in
	postinst)
		do_postinst
		;;
	*)
		echo "Usage: ${0} postinst"
		;;
esac

:
